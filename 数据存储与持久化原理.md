# æ•°æ®å­˜å‚¨ä¸æŒä¹…åŒ–åŸç†è¯´æ˜

## ğŸ“Œ é—®é¢˜å›ç­”

### Q1: ç‚¹å‡»"æ·»åŠ å¸–å­"åï¼Œæ–°å¸–å­å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ
**ç­”æ¡ˆï¼šå­˜å‚¨åœ¨ SwiftData çš„æœ¬åœ°æ•°æ®åº“ä¸­ï¼ˆSQLiteï¼‰**

### Q2: ä¸ºä»€ä¹ˆé€€å‡º Simulator åï¼Œä¸‹æ¬¡è¿›æ¥æ·»åŠ çš„å¸–å­è¿˜åœ¨ï¼Ÿ
**ç­”æ¡ˆï¼šSwiftData è‡ªåŠ¨å®ç°äº†æ•°æ®æŒä¹…åŒ–ï¼Œæ•°æ®ä¿å­˜åœ¨è®¾å¤‡çš„æœ¬åœ°æ•°æ®åº“æ–‡ä»¶ä¸­**

### Q3: æœ¬åœ° JSON æ–‡ä»¶æ²¡æœ‰å¢å‡ï¼Œæ•°æ®æ¨¡å¼æ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Ÿ
**ç­”æ¡ˆï¼šJSON æ–‡ä»¶åªæ˜¯åˆå§‹æ•°æ®æºï¼Œè¿è¡Œæ—¶ä½¿ç”¨ SwiftData æ•°æ®åº“ï¼Œä¸¤è€…æ˜¯ç‹¬ç«‹çš„**

---

## ğŸ—ï¸ æ•°æ®æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åº”ç”¨å¯åŠ¨æµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  1. åˆ›å»º SwiftData ModelContainer    â”‚
        â”‚     (newTestSwiftDataApp.swift)      â”‚
        â”‚     - é…ç½®æ•°æ®åº“å­˜å‚¨ä½ç½®              â”‚
        â”‚     - isStoredInMemoryOnly: false    â”‚
        â”‚       (æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä¸æ˜¯å†…å­˜)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  2. ä» JSON åŠ è½½åˆå§‹æ•°æ®              â”‚
        â”‚     (JSONService.loadPostsFromJSON)  â”‚
        â”‚     - è¯»å– Bundle ä¸­çš„ JSON æ–‡ä»¶      â”‚
        â”‚     - æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å·²å­˜åœ¨          â”‚
        â”‚     - åªæ’å…¥æ–°æ•°æ®ï¼Œé¿å…é‡å¤          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  3. æ•°æ®å­˜å‚¨åœ¨ SwiftData æ•°æ®åº“       â”‚
        â”‚     ä½ç½®: App Container/Library/      â”‚
        â”‚           Application Support/        â”‚
        â”‚           default.store               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ æ•°æ®å­˜å‚¨è¯¦è§£

### 1ï¸âƒ£ **SwiftData æ•°æ®åº“ï¼ˆä¸»è¦å­˜å‚¨ï¼‰**

#### å­˜å‚¨ä½ç½®
```
/Users/[ç”¨æˆ·å]/Library/Developer/CoreSimulator/Devices/
[è®¾å¤‡ID]/data/Containers/Data/Application/[åº”ç”¨ID]/
Library/Application Support/default.store
```

#### ç‰¹ç‚¹
- âœ… **æŒä¹…åŒ–å­˜å‚¨**ï¼šæ•°æ®ä¿å­˜åœ¨ SQLite æ•°æ®åº“æ–‡ä»¶ä¸­
- âœ… **è‡ªåŠ¨ç®¡ç†**ï¼šSwiftData æ¡†æ¶è‡ªåŠ¨å¤„ç†è¯»å†™ã€ç¼“å­˜ã€äº‹åŠ¡
- âœ… **è·¨ä¼šè¯ä¿ç•™**ï¼šå…³é—­åº”ç”¨åæ•°æ®ä¾ç„¶å­˜åœ¨
- âœ… **é«˜æ€§èƒ½**ï¼šæ”¯æŒç´¢å¼•ã€æŸ¥è¯¢ä¼˜åŒ–ã€æ‡’åŠ è½½

#### é…ç½®ä»£ç 

```1:16:newTestSwiftData/newTestSwiftDataApp.swift
var sharedModelContainer: ModelContainer = {
    let schema = Schema([
        Post.self,  // ä½¿ç”¨ Post æ¨¡å‹æ›¿ä»£ Item
    ])
    let modelConfiguration = ModelConfiguration(
        schema: schema, 
        isStoredInMemoryOnly: false  // ğŸ”‘ å…³é”®ï¼šfalse = æŒä¹…åŒ–åˆ°ç£ç›˜
    )

    do {
        return try ModelContainer(for: schema, configurations: [modelConfiguration])
    } catch {
        fatalError("æ— æ³•åˆ›å»º ModelContainer: \(error)")
    }
}()
```

**å…³é”®å‚æ•°è¯´æ˜ï¼š**
- `isStoredInMemoryOnly: false` â†’ æ•°æ®ä¿å­˜åˆ°ç£ç›˜ï¼ˆæŒä¹…åŒ–ï¼‰
- `isStoredInMemoryOnly: true` â†’ æ•°æ®åªåœ¨å†…å­˜ä¸­ï¼ˆå…³é—­åº”ç”¨åä¸¢å¤±ï¼‰

---

### 2ï¸âƒ£ **JSON æ–‡ä»¶ï¼ˆåˆå§‹æ•°æ®æºï¼‰**

#### å­˜å‚¨ä½ç½®
```
é¡¹ç›®ç›®å½•/Resources/
â”œâ”€â”€ PostListData_recommend_1.json  (æ¨èåˆ—è¡¨ï¼ŒID: 1000-1999)
â””â”€â”€ PostListData_hot_1.json        (çƒ­é—¨åˆ—è¡¨ï¼ŒID: 2000-2999)
```

#### ç‰¹ç‚¹
- ğŸ“¦ **åªè¯»èµ„æº**ï¼šæ‰“åŒ…åœ¨ App Bundle ä¸­ï¼Œæ— æ³•ä¿®æ”¹
- ğŸ¯ **åˆå§‹æ•°æ®**ï¼šä»…åœ¨é¦–æ¬¡å¯åŠ¨æˆ–æ•°æ®åº“ä¸ºç©ºæ—¶åŠ è½½
- ğŸ”„ **ä¸ä¼šæ›´æ–°**ï¼šè¿è¡Œæ—¶çš„å¢åˆ æ”¹ä¸ä¼šå½±å“è¿™äº›æ–‡ä»¶

#### åŠ è½½é€»è¾‘

```48:90:newTestSwiftData/Services/JSONService.swift
for (index, item) in list.enumerated() {
    guard let post = Post(from: item) else {
        print("âš ï¸ è·³è¿‡ç¬¬ \(index + 1) æ¡æ•°æ®ï¼šæ— æ³•åˆ›å»º Post å¯¹è±¡")
        skippedCount += 1
        continue
    }
    
    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒ ID çš„å¸–å­
    let postId = post.id
    let descriptor = FetchDescriptor<Post>(
        predicate: #Predicate<Post> { p in
            p.id == postId
        }
    )
    
    do {
        let existingPosts = try modelContext.fetch(descriptor)
        
        if existingPosts.isEmpty {
            postsToInsert.append(post)
        } else {
            print("âš ï¸ è·³è¿‡ ID \(postId) çš„å¸–å­ï¼šå·²å­˜åœ¨")
            skippedCount += 1
        }
    } catch {
        print("âš ï¸ æŸ¥è¯¢å·²å­˜åœ¨å¸–å­æ—¶å‡ºé”™: \(error.localizedDescription)")
        // å³ä½¿æŸ¥è¯¢å¤±è´¥ï¼Œä¹Ÿå°è¯•æ’å…¥ï¼ˆå¯èƒ½æ•°æ®åº“åˆšåˆ›å»ºï¼‰
        postsToInsert.append(post)
    }
}

// æ‰¹é‡æ’å…¥æ‰€æœ‰æ–°å¸–å­
for post in postsToInsert {
    modelContext.insert(post)
    posts.append(post)
}

do {
    try modelContext.save()
    print("âœ… æˆåŠŸåŠ è½½ \(posts.count) æ¡å¸–å­åˆ° SwiftData")
    if skippedCount > 0 {
        print("   (è·³è¿‡äº† \(skippedCount) æ¡é‡å¤æˆ–æ— æ•ˆæ•°æ®)")
    }
}
```

**é˜²é‡å¤æœºåˆ¶ï¼š**
- æ¯æ¬¡åŠ è½½å‰æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å·²å­˜åœ¨ç›¸åŒ ID çš„å¸–å­
- å·²å­˜åœ¨ â†’ è·³è¿‡
- ä¸å­˜åœ¨ â†’ æ’å…¥

---

### 3ï¸âƒ£ **Documents ç›®å½•ï¼ˆå¯é€‰çš„å¯¼å‡ºä½ç½®ï¼‰**

#### å­˜å‚¨ä½ç½®
```
App Container/Documents/
â”œâ”€â”€ PostListData_recommend_1.json  (å¯¼å‡ºçš„æ¨èåˆ—è¡¨)
â””â”€â”€ PostListData_hot_1.json        (å¯¼å‡ºçš„çƒ­é—¨åˆ—è¡¨)
```

#### ç‰¹ç‚¹
- ğŸ“ **å¯å†™ç›®å½•**ï¼šåº”ç”¨å¯ä»¥åœ¨æ­¤åˆ›å»ºå’Œä¿®æ”¹æ–‡ä»¶
- ğŸ’¾ **æ•°æ®å¯¼å‡º**ï¼š`JSONService.savePostsToJSON()` ä¼šå°†æ•°æ®åº“å†…å®¹å¯¼å‡ºåˆ°è¿™é‡Œ
- ğŸ” **è°ƒè¯•ç”¨é€”**ï¼šå¯ä»¥æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„å®é™…å†…å®¹

#### å¯¼å‡ºä»£ç 

```106:145:newTestSwiftData/Services/JSONService.swift
// æ ¹æ®æ–‡ä»¶åç¡®å®š ID èŒƒå›´
let idRange: Range<Int>
if fileName.contains("recommend") {
    idRange = 1000..<2000
} else if fileName.contains("hot") {
    idRange = 2000..<3000
} else {
    // é»˜è®¤ä¿å­˜æ‰€æœ‰å¸–å­
    let descriptor = FetchDescriptor<Post>(sortBy: [SortDescriptor(\.id)])
    let posts = try modelContext.fetch(descriptor)
    
    let jsonArray = posts.map { $0.toJSON() }
    let json: [String: Any] = ["list": jsonArray]
    
    guard let documentsURL = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).first else {
        print("âŒ æ— æ³•è·å– Documents ç›®å½•")
        return false
    }
    
    let fileURL = documentsURL.appendingPathComponent(fileName)
    let jsonData = try JSONSerialization.data(withJSONObject: json, options: [.prettyPrinted, .sortedKeys])
    try jsonData.write(to: fileURL)
    
    print("âœ… æˆåŠŸä¿å­˜ \(posts.count) æ¡å¸–å­åˆ°: \(fileURL.path)")
    return true
}

// åªè·å–æŒ‡å®š ID èŒƒå›´çš„å¸–å­
let minId = idRange.lowerBound
let maxId = idRange.upperBound
let descriptor = FetchDescriptor<Post>(
    predicate: #Predicate<Post> { post in
        post.id >= minId && post.id < maxId
    },
    sortBy: [SortDescriptor(\.id)]
)
let posts = try modelContext.fetch(descriptor)

let jsonArray = posts.map { $0.toJSON() }
let json: [String: Any] = ["list": jsonArray]
```

---

## ğŸ”„ å®Œæ•´æ•°æ®æµç¨‹

### åœºæ™¯ 1ï¼šé¦–æ¬¡å¯åŠ¨åº”ç”¨

```
1. åˆ›å»º SwiftData æ•°æ®åº“
   â””â”€> default.store (ç©ºæ•°æ®åº“)

2. ä» Bundle åŠ è½½ JSON
   â”œâ”€> PostListData_recommend_1.json
   â””â”€> PostListData_hot_1.json

3. æ’å…¥æ•°æ®åˆ° SwiftData
   â””â”€> æ•°æ®åº“ç°åœ¨åŒ…å«æ‰€æœ‰åˆå§‹å¸–å­

4. æ˜¾ç¤ºåˆ—è¡¨
   â””â”€> ä» SwiftData è¯»å–å¹¶æ˜¾ç¤º
```

### åœºæ™¯ 2ï¼šæ·»åŠ æ–°å¸–å­

```
1. ç”¨æˆ·ç‚¹å‡»"æ·»åŠ å¸–å­"æŒ‰é’®
   â””â”€> æ‰“å¼€ AddPostView

2. å¡«å†™è¡¨å•å¹¶ç‚¹å‡»"ä¿å­˜"
   â”œâ”€> ç”Ÿæˆæ–°çš„ IDï¼ˆæ ¹æ®åˆ—è¡¨ç±»å‹ï¼‰
   â”‚   â”œâ”€> æ¨èåˆ—è¡¨: 1000-1999
   â”‚   â””â”€> çƒ­é—¨åˆ—è¡¨: 2000-2999
   â””â”€> åˆ›å»º Post å¯¹è±¡

3. æ’å…¥åˆ° SwiftData
   â””â”€> modelContext.insert(newPost)
   â””â”€> try modelContext.save()  // ğŸ”‘ æŒä¹…åŒ–åˆ°ç£ç›˜

4. (å¯é€‰) å¯¼å‡ºåˆ° Documents
   â””â”€> JSONService.savePostsToJSON()
   â””â”€> ç”Ÿæˆ JSON æ–‡ä»¶åˆ° Documents ç›®å½•

5. ç•Œé¢è‡ªåŠ¨æ›´æ–°
   â””â”€> SwiftUI ç›‘å¬ @Queryï¼Œè‡ªåŠ¨åˆ·æ–°åˆ—è¡¨
```

**å…³é”®ä»£ç ï¼š**

```67:88:newTestSwiftData/Views/AddPostView.swift
let newPost = Post(
    id: newId,
    avatar: avatar.isEmpty ? "default_avatar.jpg" : avatar,
    vip: false,
    name: name,
    date: dateString,
    isFollowed: false,
    text: text,
    images: images,
    commentCount: 0,
    likeCount: 0,
    isLiked: false
)

modelContext.insert(newPost)

// ä¿å­˜åˆ° SwiftData
do {
    try modelContext.save()
    print("âœ… æ–°å¸–å­å·²ä¿å­˜åˆ°\(listType == .recommend ? "æ¨è" : "çƒ­é—¨")åˆ—è¡¨ï¼ŒID: \(newId)")
} catch {
    print("âŒ ä¿å­˜å¤±è´¥: \(error)")
}
```

### åœºæ™¯ 3ï¼šåˆ é™¤å¸–å­

```
1. ç”¨æˆ·ç‚¹å‡»åˆ é™¤æŒ‰é’®
   â””â”€> æ˜¾ç¤ºç¡®è®¤å¼¹çª—

2. ç¡®è®¤åˆ é™¤
   â””â”€> modelContext.delete(post)
   â””â”€> try modelContext.save()  // ğŸ”‘ ä»æ•°æ®åº“ä¸­åˆ é™¤

3. (å¯é€‰) åŒæ­¥åˆ° Documents
   â””â”€> JSONService.savePostsToJSON()
   â””â”€> æ›´æ–°å¯¼å‡ºçš„ JSON æ–‡ä»¶

4. ç•Œé¢è‡ªåŠ¨æ›´æ–°
   â””â”€> å¸–å­ä»åˆ—è¡¨ä¸­æ¶ˆå¤±
```

### åœºæ™¯ 4ï¼šå…³é—­å¹¶é‡æ–°æ‰“å¼€åº”ç”¨

```
1. å…³é—­åº”ç”¨
   â””â”€> SwiftData æ•°æ®åº“æ–‡ä»¶ä¿ç•™åœ¨ç£ç›˜

2. é‡æ–°æ‰“å¼€åº”ç”¨
   â”œâ”€> è¯»å–ç°æœ‰çš„ default.store
   â”œâ”€> å°è¯•ä» JSON åŠ è½½æ•°æ®
   â”‚   â””â”€> æ£€æµ‹åˆ°æ‰€æœ‰æ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡åŠ è½½
   â””â”€> æ˜¾ç¤ºä¸Šæ¬¡çš„æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬æ–°æ·»åŠ çš„å¸–å­ï¼‰

âœ… æ‰€æœ‰æ•°æ®éƒ½åœ¨ï¼
```

---

## ğŸ¯ ä¸ºä»€ä¹ˆ JSON æ–‡ä»¶ä¸ä¼šå˜åŒ–ï¼Ÿ

### åŸå› åˆ†æ

| æ–‡ä»¶ä½ç½® | æ˜¯å¦å¯å†™ | ç”¨é€” | æ˜¯å¦ä¼šå˜åŒ– |
|---------|---------|------|-----------|
| **Bundle/Resources/** | âŒ åªè¯» | åˆå§‹æ•°æ®æº | âŒ æ°¸è¿œä¸å˜ |
| **SwiftData æ•°æ®åº“** | âœ… å¯å†™ | è¿è¡Œæ—¶æ•°æ®å­˜å‚¨ | âœ… å®æ—¶å˜åŒ– |
| **Documents/** | âœ… å¯å†™ | æ•°æ®å¯¼å‡º/è°ƒè¯• | âœ… æ‰‹åŠ¨å¯¼å‡ºæ—¶å˜åŒ– |

### è¯¦ç»†è¯´æ˜

1. **Bundle ä¸­çš„ JSON æ˜¯åªè¯»çš„**
   - è¿™äº›æ–‡ä»¶åœ¨ç¼–è¯‘æ—¶æ‰“åŒ…è¿› App Bundle
   - iOS ç³»ç»Ÿä¸å…è®¸åº”ç”¨ä¿®æ”¹ Bundle ä¸­çš„æ–‡ä»¶
   - å®ƒä»¬åªæ˜¯"ç§å­æ•°æ®"ï¼Œç”¨äºåˆå§‹åŒ–æ•°æ®åº“

2. **è¿è¡Œæ—¶ä½¿ç”¨ SwiftData æ•°æ®åº“**
   - æ‰€æœ‰çš„å¢åˆ æ”¹æŸ¥éƒ½åœ¨æ•°æ®åº“ä¸­è¿›è¡Œ
   - æ•°æ®åº“æ–‡ä»¶æ˜¯å¯å†™çš„ï¼Œæ”¯æŒæŒä¹…åŒ–
   - è¿™æ˜¯çœŸæ­£çš„"æ•°æ®æº"

3. **JSON å¯¼å‡ºæ˜¯å¯é€‰çš„**
   - `JSONService.savePostsToJSON()` ä¼šå¯¼å‡ºåˆ° Documents
   - è¿™åªæ˜¯ä¸ºäº†è°ƒè¯•æˆ–æ•°æ®å¤‡ä»½
   - ä¸å½±å“åº”ç”¨çš„æ­£å¸¸è¿è¡Œ

---

## ğŸ” æ•°æ®æŒä¹…åŒ–çš„å…³é”®æŠ€æœ¯

### 1. SwiftData çš„ `@Model` å®

```9:11:newTestSwiftData/Models/Post.swift
@Model
final class Post {
    /// å¸–å­å”¯ä¸€æ ‡è¯†ç¬¦
```

- è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“æ˜ å°„ä»£ç 
- æ”¯æŒå±æ€§è§‚å¯Ÿå’Œå˜æ›´è¿½è¸ª
- ä¸ SwiftUI æ— ç¼é›†æˆ

### 2. `ModelConfiguration` é…ç½®

```swift
let modelConfiguration = ModelConfiguration(
    schema: schema, 
    isStoredInMemoryOnly: false  // ğŸ”‘ æŒä¹…åŒ–å…³é”®
)
```

- `false` â†’ æ•°æ®ä¿å­˜åˆ°ç£ç›˜ï¼ˆSQLiteï¼‰
- `true` â†’ æ•°æ®åªåœ¨å†…å­˜ä¸­ï¼ˆæµ‹è¯•ç”¨ï¼‰

### 3. `ModelContext` ä¸Šä¸‹æ–‡ç®¡ç†

```swift
modelContext.insert(newPost)  // æ·»åŠ åˆ°ä¸Šä¸‹æ–‡
try modelContext.save()       // ğŸ”‘ æäº¤åˆ°æ•°æ®åº“ï¼ˆæŒä¹…åŒ–ï¼‰
```

- `insert()` â†’ æ ‡è®°ä¸ºå¾…æ’å…¥
- `delete()` â†’ æ ‡è®°ä¸ºå¾…åˆ é™¤
- `save()` â†’ å°†æ‰€æœ‰å˜æ›´å†™å…¥æ•°æ®åº“

### 4. SwiftUI çš„ `@Query` å±æ€§åŒ…è£…å™¨

```swift
@Query(sort: \Post.id, order: .reverse) var posts: [Post]
```

- è‡ªåŠ¨ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®
- ç›‘å¬æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨åˆ·æ–° UI
- æ”¯æŒè¿‡æ»¤ã€æ’åºã€åˆ†é¡µ

---

## ğŸ“Š æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®æµå‘                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é¦–æ¬¡å¯åŠ¨:
Bundle JSON â”€â”€è¯»å–â”€â”€> SwiftData æ•°æ®åº“ â”€â”€æŸ¥è¯¢â”€â”€> UI æ˜¾ç¤º

æ·»åŠ å¸–å­:
ç”¨æˆ·è¾“å…¥ â”€â”€ä¿å­˜â”€â”€> SwiftData æ•°æ®åº“ â”€â”€è‡ªåŠ¨åˆ·æ–°â”€â”€> UI æ˜¾ç¤º
                        â”‚
                        â””â”€â”€å¯¼å‡ºâ”€â”€> Documents JSON (å¯é€‰)

åˆ é™¤å¸–å­:
ç”¨æˆ·æ“ä½œ â”€â”€åˆ é™¤â”€â”€> SwiftData æ•°æ®åº“ â”€â”€è‡ªåŠ¨åˆ·æ–°â”€â”€> UI æ˜¾ç¤º
                        â”‚
                        â””â”€â”€å¯¼å‡ºâ”€â”€> Documents JSON (å¯é€‰)

é‡æ–°å¯åŠ¨:
SwiftData æ•°æ®åº“ â”€â”€è¯»å–â”€â”€> UI æ˜¾ç¤º
(Bundle JSON æ£€æµ‹åˆ°æ•°æ®å·²å­˜åœ¨ï¼Œä¸å†åŠ è½½)
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒæ¦‚å¿µ

1. **SwiftData æ˜¯ä¸»è¦çš„æ•°æ®å­˜å‚¨**
   - åŸºäº SQLiteï¼Œæ”¯æŒæŒä¹…åŒ–
   - è‡ªåŠ¨ç®¡ç†æ•°æ®çš„è¯»å†™å’Œç¼“å­˜
   - æ•°æ®ä¿å­˜åœ¨åº”ç”¨çš„æ²™ç›’ç›®å½•ä¸­

2. **JSON æ–‡ä»¶åªæ˜¯åˆå§‹æ•°æ®**
   - æ‰“åŒ…åœ¨ Bundle ä¸­ï¼Œåªè¯»
   - ä»…åœ¨é¦–æ¬¡å¯åŠ¨æˆ–æ•°æ®åº“ä¸ºç©ºæ—¶åŠ è½½
   - è¿è¡Œæ—¶çš„å˜æ›´ä¸ä¼šå½±å“è¿™äº›æ–‡ä»¶

3. **æ•°æ®æŒä¹…åŒ–æ˜¯è‡ªåŠ¨çš„**
   - `isStoredInMemoryOnly: false` ç¡®ä¿æ•°æ®ä¿å­˜åˆ°ç£ç›˜
   - `modelContext.save()` å°†å˜æ›´æäº¤åˆ°æ•°æ®åº“
   - å…³é—­åº”ç”¨åæ•°æ®ä¾ç„¶å­˜åœ¨

4. **UI è‡ªåŠ¨åŒæ­¥**
   - SwiftUI çš„ `@Query` ç›‘å¬æ•°æ®åº“å˜åŒ–
   - æ•°æ®å˜æ›´åè‡ªåŠ¨åˆ·æ–°ç•Œé¢
   - æ— éœ€æ‰‹åŠ¨ç®¡ç†çŠ¶æ€

### ä¼˜åŠ¿

âœ… **ç®€å•æ˜“ç”¨**ï¼šæ— éœ€æ‰‹åŠ¨ç®¡ç†æ•°æ®åº“è¿æ¥å’Œ SQL  
âœ… **è‡ªåŠ¨æŒä¹…åŒ–**ï¼šæ•°æ®è‡ªåŠ¨ä¿å­˜ï¼Œæ— éœ€é¢å¤–ä»£ç   
âœ… **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯  
âœ… **é«˜æ€§èƒ½**ï¼šæ”¯æŒæ‡’åŠ è½½ã€ç´¢å¼•ã€æŸ¥è¯¢ä¼˜åŒ–  
âœ… **SwiftUI é›†æˆ**ï¼šä¸ `@Query` æ— ç¼é…åˆï¼Œè‡ªåŠ¨åˆ·æ–° UI  

### æ•°æ®å­˜å‚¨ä½ç½®æ€»ç»“

| ä½ç½® | è·¯å¾„ | å¯å†™ | ç”¨é€” |
|-----|------|------|------|
| **Bundle** | `App.app/Resources/*.json` | âŒ | åˆå§‹æ•°æ® |
| **SwiftData** | `Library/Application Support/default.store` | âœ… | è¿è¡Œæ—¶æ•°æ® |
| **Documents** | `Documents/*.json` | âœ… | å¯¼å‡º/è°ƒè¯• |

---

## ğŸ”§ å¦‚ä½•æŸ¥çœ‹æ•°æ®åº“å†…å®¹ï¼Ÿ

### æ–¹æ³• 1ï¼šä½¿ç”¨ Xcode çš„ Debug å·¥å…·

1. è¿è¡Œåº”ç”¨
2. ç‚¹å‡» Xcode åº•éƒ¨çš„ "View Debug Database" æŒ‰é’®
3. é€‰æ‹© "default.store"
4. æŸ¥çœ‹æ‰€æœ‰ Post è®°å½•

### æ–¹æ³• 2ï¼šå¯¼å‡º JSON æŸ¥çœ‹

åœ¨ä»£ç ä¸­è°ƒç”¨ï¼š
```swift
JSONService.savePostsToJSON(
    fileName: "debug_export.json", 
    modelContext: modelContext
)
```

ç„¶ååœ¨ Xcode ä¸­æŸ¥çœ‹ï¼š
1. Window â†’ Devices and Simulators
2. é€‰æ‹©ä½ çš„ Simulator
3. æ‰¾åˆ°åº”ç”¨ï¼Œç‚¹å‡» "Download Container"
4. åœ¨ Finder ä¸­æ‰“å¼€ï¼Œè¿›å…¥ `Documents/` ç›®å½•
5. æŸ¥çœ‹å¯¼å‡ºçš„ JSON æ–‡ä»¶

### æ–¹æ³• 3ï¼šä½¿ç”¨ SQLite å·¥å…·

1. æ‰¾åˆ° `default.store` æ–‡ä»¶ä½ç½®ï¼ˆè§ä¸Šæ–‡ï¼‰
2. ä½¿ç”¨ DB Browser for SQLite æ‰“å¼€
3. æŸ¥çœ‹ `ZPOST` è¡¨ï¼ˆSwiftData è‡ªåŠ¨ç”Ÿæˆçš„è¡¨åï¼‰

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆåˆ é™¤åº”ç”¨åæ•°æ®ä¼šä¸¢å¤±ï¼Ÿ
**A:** åº”ç”¨çš„æ²™ç›’ç›®å½•ä¼šè¢«å®Œå…¨åˆ é™¤ï¼ŒåŒ…æ‹¬ SwiftData æ•°æ®åº“ã€‚è¿™æ˜¯ iOS çš„å®‰å…¨æœºåˆ¶ã€‚

### Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ
**A:** ä½¿ç”¨ `JSONService.savePostsToJSON()` å¯¼å‡ºåˆ° Documentsï¼Œç„¶åé€šè¿‡ iTunes æ–‡ä»¶å…±äº«æˆ– iCloud å¤‡ä»½ã€‚

### Q: å¯ä»¥ä¿®æ”¹ Bundle ä¸­çš„ JSON å—ï¼Ÿ
**A:** ä¸å¯ä»¥ã€‚Bundle æ˜¯åªè¯»çš„ã€‚å¦‚æœéœ€è¦ä¿®æ”¹åˆå§‹æ•°æ®ï¼Œéœ€è¦åœ¨ Xcode é¡¹ç›®ä¸­ä¿®æ”¹ JSON æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç¼–è¯‘ã€‚

### Q: æ•°æ®åº“æ–‡ä»¶ä¼šå ç”¨å¤šå°‘ç©ºé—´ï¼Ÿ
**A:** å–å†³äºæ•°æ®é‡ã€‚æ¯æ¡å¸–å­å¤§çº¦ 1-2 KBï¼Œ1000 æ¡å¸–å­çº¦ 1-2 MBã€‚SwiftData ä¼šè‡ªåŠ¨å‹ç¼©å’Œä¼˜åŒ–ã€‚

### Q: å¦‚ä½•æ¸…ç©ºæ•°æ®åº“é‡æ–°åŠ è½½ JSONï¼Ÿ
**A:** åˆ é™¤åº”ç”¨é‡æ–°å®‰è£…ï¼Œæˆ–è€…åœ¨ä»£ç ä¸­åˆ é™¤æ‰€æœ‰ Post è®°å½•ï¼š
```swift
let descriptor = FetchDescriptor<Post>()
let allPosts = try modelContext.fetch(descriptor)
allPosts.forEach { modelContext.delete($0) }
try modelContext.save()
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [SwiftData å®˜æ–¹æ–‡æ¡£](https://developer.apple.com/documentation/swiftdata)
- [ModelContainer é…ç½®](https://developer.apple.com/documentation/swiftdata/modelconfiguration)
- [æ•°æ®æŒä¹…åŒ–æœ€ä½³å®è·µ](https://developer.apple.com/documentation/swiftdata/preserving-your-apps-model-data-across-launches)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-25  
**é€‚ç”¨é¡¹ç›®**: newTestSwiftData

