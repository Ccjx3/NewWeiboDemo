# iOS 开发校招面试准备指南 - 项目概述

## 📱 项目基本信息

**项目名称**: 仿微博社交媒体应用  
**技术栈**: SwiftUI + SwiftData + Alamofire + AVKit  
**开发周期**: 2026年1月  
**iOS 版本**: iOS 15.0+  
**代码行数**: 约 2000+ 行

---

## 🎯 项目亮点总结（面试必说）

### 1. **现代化技术栈**
- ✅ 使用 **SwiftUI** 构建声明式 UI
- ✅ 采用 **SwiftData** 实现数据持久化（iOS 17 新特性）
- ✅ 集成 **Combine** 框架处理异步事件
- ✅ 使用 **AVKit** 实现视频播放功能

### 2. **完整的功能模块**
- ✅ 帖子列表展示（推荐/热门双 Tab）
- ✅ 图片多图布局（1-6张智能布局）
- ✅ 视频播放（支持静音切换、全屏播放）
- ✅ 图片浏览器（仿小红书/微博）
- ✅ 点赞、评论、关注等社交功能
- ✅ 添加帖子功能
- ✅ 数据持久化与 JSON 同步

### 3. **架构设计能力**
- ✅ **MVVM 架构**：Model（Post）+ View（SwiftUI）+ ViewModel（隐式）
- ✅ **分层设计**：网络层、服务层、视图层清晰分离
- ✅ **单例模式**：NetworkManager 统一管理网络请求
- ✅ **依赖注入**：通过 Environment 注入 ModelContext

### 4. **性能优化**
- ✅ 使用 **LazyVStack** 实现列表懒加载
- ✅ 图片异步加载（SDWebImage）
- ✅ 视频按需加载，离开页面自动释放
- ✅ 数据库查询优化（使用 Predicate 过滤）

---

## 📊 技术难点与解决方案

### 难点 1: SwiftData 数据持久化

**问题**: 如何将 JSON 数据导入 SwiftData，并保持双向同步？

**解决方案**:
```swift
// 1. 定义 @Model 数据模型
@Model
final class Post {
    @Attribute(.unique) var id: Int
    var images: [String]  // 存储文件名而非二进制数据
    // ...
}

// 2. JSON 转 SwiftData
convenience init?(from json: [String: Any]) {
    guard let id = json["id"] as? Int else { return nil }
    self.init(id: id, ...)
}

// 3. SwiftData 转 JSON
func toJSON() -> [String: Any] {
    return ["id": id, ...]
}
```

**技术要点**:
- 使用 `@Attribute(.unique)` 确保 ID 唯一性
- 图片存储文件名而非二进制，减小数据库体积
- 实现双向转换，支持数据导入导出

---

### 难点 2: 多图布局算法

**问题**: 如何根据图片数量（1-6张）自动调整布局？

**解决方案**:
```swift
// 动态计算布局
switch images.count {
case 1: 单张大图（3:4 比例）
case 2: 横向 2 列
case 3: 横向 3 列
case 4: 2x2 网格
case 5: 第一行 2 张 + 第二行 3 张
case 6: 2x3 网格
}
```

**技术要点**:
- 使用 GeometryReader 获取可用宽度
- 动态计算每张图片尺寸
- 支持点击图片进入全屏浏览

---

### 难点 3: 视频播放与控制

**问题**: 如何实现类似微博的视频播放效果（自动播放、静音切换、全屏）？

**解决方案**:
```swift
// 1. 使用 AVPlayer + VideoPlayer
@State private var player: AVPlayer?

// 2. 监听播放状态
playerItem.publisher(for: \.status)
    .sink { status in
        if status == .readyToPlay {
            player.play()
        }
    }

// 3. 循环播放
NotificationCenter.default.addObserver(
    forName: .AVPlayerItemDidPlayToEndTime
) { _ in
    player.seek(to: .zero)
    player.play()
}

// 4. 自定义静音按钮
Button { player.isMuted.toggle() }
```

**技术要点**:
- 使用 Combine 监听播放器状态
- 实现自动循环播放
- 双击进入全屏模式
- 页面消失时自动释放资源

---

### 难点 4: 网络请求架构

**问题**: 如何设计可扩展的网络请求层？

**解决方案**:
```
NetworkAPI (应用层) 
    ↓ 
NetworkManager (管理层) 
    ↓ 
Alamofire (底层)
```

**技术要点**:
- 单例模式管理网络请求
- 统一配置 BaseURL 和 Headers
- 泛型方法实现类型安全的数据解析
- 友好的错误处理机制

---

## 🎤 面试常见问题及回答

### Q1: 为什么选择 SwiftData 而不是 Core Data？

**回答要点**:
1. **简洁性**: SwiftData 使用 `@Model` 宏，代码量减少 70%
2. **类型安全**: 编译时检查，减少运行时错误
3. **SwiftUI 集成**: `@Query` 自动同步数据变化
4. **现代化**: 基于 Swift 宏系统，是 Apple 推荐的新方案

**示例代码**:
```swift
// Core Data 需要 30+ 行代码
// SwiftData 只需 3 行
@Model
final class Post {
    var id: Int
}
```

---

### Q2: 如何优化列表滚动性能？

**回答要点**:
1. **LazyVStack**: 按需加载视图，不是一次性创建所有
2. **图片异步加载**: 使用 SDWebImage 缓存
3. **视频懒加载**: 只在可见时创建播放器
4. **数据分页**: 支持推荐/热门分类加载

**代码示例**:
```swift
ScrollView {
    LazyVStack {  // 懒加载
        ForEach(posts) { post in
            PostCellView(post: post)
        }
    }
}
```

---

### Q3: 图片为什么存储文件名而不是二进制数据？

**回答要点**:
1. **数据库体积**: 文件名 < 100 字节，图片可能几 MB
2. **查询速度**: 字符串比较比二进制快得多
3. **资源管理**: 图片统一放在 Resources，便于管理
4. **异步加载**: 支持渐进式加载，不阻塞 UI

**对比**:
```swift
// ❌ 存储二进制（数据库膨胀）
@Attribute(.externalStorage) var imageData: Data?

// ✅ 存储文件名（推荐）
var imageName: String  // "avatar.jpg"
```

---

### Q4: 如何处理网络请求错误？

**回答要点**:
1. **分类处理**: 区分网络错误、解析错误、业务错误
2. **友好提示**: 将技术错误转换为用户可理解的提示
3. **重试机制**: 网络失败时支持重试
4. **日志记录**: 便于调试和问题追踪

**代码示例**:
```swift
private func handleError(_ error: AFError) -> NetworkRequestResult {
    if code == NSURLErrorNotConnectedToInternet {
        return .failure(NSError(
            domain: "网络连接有问题喔～"
        ))
    }
    return .failure(error)
}
```

---

### Q5: 如何实现图片浏览器？

**回答要点**:
1. **使用 CocoaPods**: 集成 JXPhotoBrowser 第三方库
2. **UIKit 桥接**: 通过 UIViewControllerRepresentable 桥接到 SwiftUI
3. **手势支持**: 支持缩放、拖拽、双击
4. **索引定位**: 点击第几张图片就显示第几张

**关键代码**:
```swift
.fullScreenCover(isPresented: $showPhotoBrowser) {
    NativePhotoBrowser(
        images: images,
        initialIndex: selectedImageIndex
    )
}
```

---

## 💡 项目可以讲的故事

### 故事 1: 数据持久化方案选型

"在项目初期，我对比了三种方案：UserDefaults、Core Data 和 SwiftData。最终选择 SwiftData 是因为..."

### 故事 2: 性能优化实践

"在测试中发现滚动列表时会卡顿，通过 Instruments 分析发现是图片加载导致的。我采用了..."

### 故事 3: 视频播放问题排查

"视频播放时遇到了静音按钮不生效的问题，通过查看 AVPlayer 文档和调试，发现是..."

---

## 📈 项目数据（可量化的成果）

- **代码行数**: 2000+ 行
- **功能模块**: 8 个主要模块
- **第三方库**: 4 个（Alamofire、SDWebImage、JXPhotoBrowser、BBSwiftUIKit）
- **支持图片**: 最多 6 张智能布局
- **视频格式**: MP4，支持网络加载
- **数据模型**: 1 个核心模型（Post），12 个属性
- **视图组件**: 15+ 个可复用组件

---

## 🎯 下一步改进建议

详见《面试准备指南-改进建议》文档。

