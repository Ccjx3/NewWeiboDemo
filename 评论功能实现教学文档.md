# SwiftUI è¯„è®ºåŠŸèƒ½å®ç°æ•™å­¦æ–‡æ¡£

## ğŸ“š ç›®å½•
1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#æ ¸å¿ƒç»„ä»¶è¯¦è§£)
4. [å…³é”®æŠ€æœ¯ç‚¹](#å…³é”®æŠ€æœ¯ç‚¹)
5. [ä»£ç å®ç°è¯¦è§£](#ä»£ç å®ç°è¯¦è§£)
6. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
7. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)

---

## åŠŸèƒ½æ¦‚è¿°

æœ¬æ•™ç¨‹å°†å¸¦ä½ å®ç°ä¸€ä¸ªç±»ä¼¼å¾®åšçš„è¯„è®ºè¾“å…¥åŠŸèƒ½ï¼ŒåŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š

- âœ… è‡ªåŠ¨å¼¹å‡ºé”®ç›˜
- âœ… æ”¯æŒæ»‘åŠ¨æ‰‹åŠ¿æ”¶èµ·é”®ç›˜
- âœ… å®æ—¶æ–‡æœ¬è¾“å…¥ä¸ç»‘å®š
- âœ… ç©ºå†…å®¹éªŒè¯ä¸æç¤º
- âœ… è¯„è®ºæ•°é‡å®æ—¶æ›´æ–°
- âœ… ä¼˜é›…çš„åŠ¨ç”»æ•ˆæœ

---

## æ¶æ„è®¾è®¡

### ç»„ä»¶å±‚æ¬¡ç»“æ„

```
CommentInputView (ä¸»è§†å›¾)
â”œâ”€â”€ CommentTextView (æ–‡æœ¬è¾“å…¥ç»„ä»¶)
â”‚   â””â”€â”€ UITextView (UIKit å°è£…)
â”œâ”€â”€ åº•éƒ¨æ“ä½œæ 
â”‚   â”œâ”€â”€ å–æ¶ˆæŒ‰é’®
â”‚   â””â”€â”€ å‘é€æŒ‰é’®
â””â”€â”€ æç¤ºä¿¡æ¯è¦†ç›–å±‚
```

### æ•°æ®æµå‘

```
ç”¨æˆ·è¾“å…¥ â†’ UITextView â†’ Coordinator â†’ @Binding text â†’ CommentInputView
                                                              â†“
                                                         éªŒè¯ & å¤„ç†
                                                              â†“
                                                    æ›´æ–° UserData (EnvironmentObject)
```

---

## æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. CommentTextView - UIKit æ¡¥æ¥ç»„ä»¶

**ä½œç”¨**ï¼šå°† UIKit çš„ `UITextView` å°è£…æˆ SwiftUI å¯ç”¨çš„è§†å›¾ç»„ä»¶

**æ ¸å¿ƒåè®®**ï¼š`UIViewRepresentable`

#### å…³é”®å±æ€§

```swift
@Binding var text: String              // åŒå‘ç»‘å®šçš„æ–‡æœ¬å†…å®¹
let beginEdittingOnAppear: Bool        // æ˜¯å¦åœ¨å‡ºç°æ—¶è‡ªåŠ¨å¼€å§‹ç¼–è¾‘
```

#### ä¸‰å¤§æ ¸å¿ƒæ–¹æ³•

| æ–¹æ³• | ä½œç”¨ | è°ƒç”¨æ—¶æœº |
|------|------|----------|
| `makeCoordinator()` | åˆ›å»ºåè°ƒå™¨ï¼Œå¤„ç† UIKit ä¸ SwiftUI çš„é€šä¿¡ | è§†å›¾åˆ›å»ºæ—¶ |
| `makeUIView(context:)` | åˆ›å»ºå¹¶é…ç½® UITextView | è§†å›¾é¦–æ¬¡æ˜¾ç¤ºæ—¶ |
| `updateUIView(_:context:)` | æ›´æ–° UITextView çŠ¶æ€ | SwiftUI çŠ¶æ€å˜åŒ–æ—¶ |

---

### 2. CommentInputView - ä¸»ç•Œé¢ç»„ä»¶

**ä½œç”¨**ï¼šæä¾›å®Œæ•´çš„è¯„è®ºè¾“å…¥ç•Œé¢ï¼ŒåŒ…æ‹¬æ–‡æœ¬è¾“å…¥åŒºåŸŸå’Œæ“ä½œæŒ‰é’®

#### æ ¸å¿ƒå±æ€§

```swift
let post: Post                                    // è¢«è¯„è®ºçš„å¸–å­
@Environment(\.presentationMode) var presentationMode  // æ§åˆ¶è§†å›¾å…³é—­
@EnvironmentObject var userData: UserData         // å…¨å±€ç”¨æˆ·æ•°æ®
@State private var text: String = ""              // è¾“å…¥çš„è¯„è®ºå†…å®¹
@State private var showEmptyTextHUD: Bool = false // ç©ºå†…å®¹æç¤ºçŠ¶æ€
```

---

## å…³é”®æŠ€æœ¯ç‚¹

### ğŸ”‘ æŠ€æœ¯ç‚¹ 1ï¼šUIViewRepresentable åè®®

**ç”¨é€”**ï¼šåœ¨ SwiftUI ä¸­ä½¿ç”¨ UIKit ç»„ä»¶

**ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ**
- SwiftUI çš„ `TextEditor` åŠŸèƒ½æœ‰é™ï¼Œæ— æ³•ç²¾ç»†æ§åˆ¶é”®ç›˜è¡Œä¸º
- UIKit çš„ `UITextView` æä¾›äº†æ›´å¼ºå¤§çš„è‡ªå®šä¹‰èƒ½åŠ›

**å®ç°æ­¥éª¤**ï¼š

```swift
struct CommentTextView: UIViewRepresentable {
    // 1. å®šä¹‰æ•°æ®ç»‘å®š
    @Binding var text: String
    
    // 2. åˆ›å»ºåè°ƒå™¨ï¼ˆå¤„ç†å§”æ‰˜ï¼‰
    func makeCoordinator() -> Coordinator {
        Coordinator(self)
    }
    
    // 3. åˆ›å»º UIKit è§†å›¾
    func makeUIView(context: Context) -> UITextView {
        let view = UITextView()
        // é…ç½®è§†å›¾...
        return view
    }
    
    // 4. æ›´æ–°è§†å›¾
    func updateUIView(_ uiView: UITextView, context: Context) {
        // æ›´æ–°é€»è¾‘...
    }
    
    // 5. åè°ƒå™¨ç±»ï¼ˆå®ç°å§”æ‰˜ï¼‰
    class Coordinator: NSObject, UITextViewDelegate {
        // å§”æ‰˜æ–¹æ³•...
    }
}
```

---

### ğŸ”‘ æŠ€æœ¯ç‚¹ 2ï¼šCoordinator æ¨¡å¼

**ä½œç”¨**ï¼šä½œä¸º UIKit å’Œ SwiftUI ä¹‹é—´çš„æ¡¥æ¢ï¼Œå¤„ç†å§”æ‰˜å›è°ƒ

**å·¥ä½œåŸç†**ï¼š

```
UITextView äº‹ä»¶ â†’ UITextViewDelegate â†’ Coordinator â†’ æ›´æ–° @Binding â†’ SwiftUI åˆ·æ–°
```

**ä»£ç ç¤ºä¾‹**ï¼š

```swift
class Coordinator: NSObject, UITextViewDelegate {
    let parent: CommentTextView
    var disBecomeFirstResponder: Bool = false
    
    init(_ view: CommentTextView) { 
        parent = view 
    }
    
    // ç›‘å¬æ–‡æœ¬å˜åŒ–
    func textViewDidChange(_ textView: UITextView) {
        parent.text = textView.text  // æ›´æ–° SwiftUI çš„ @Binding
    }
}
```

---

### ğŸ”‘ æŠ€æœ¯ç‚¹ 3ï¼šé”®ç›˜äº¤äº’ä¼˜åŒ–

#### é—®é¢˜ï¼šå¦‚ä½•å®ç°"æ»‘åŠ¨æ”¶èµ·é”®ç›˜"ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šé…ç½® UITextView çš„é”®ç›˜è¡Œä¸º

```swift
// â­ å…³é”®é…ç½® 1ï¼šäº¤äº’å¼é”®ç›˜æ”¶èµ·æ¨¡å¼
view.keyboardDismissMode = .interactive
// æ•ˆæœï¼šç”¨æˆ·å‘ä¸‹æ»‘åŠ¨å†…å®¹æ—¶ï¼Œé”®ç›˜ä¼šè·Ÿéšæ‰‹åŠ¿åŒæ­¥æ”¶èµ·

// â­ å…³é”®é…ç½® 2ï¼šå§‹ç»ˆå…è®¸å‚ç›´å¼¹è·³
view.alwaysBounceVertical = true
// æ•ˆæœï¼šå³ä½¿å†…å®¹ä¸è¶³ä»¥æ»šåŠ¨ï¼Œä¹Ÿèƒ½äº§ç”Ÿæ»‘åŠ¨æ•ˆæœæ¥è§¦å‘é”®ç›˜æ”¶èµ·

// â­ å…³é”®é…ç½® 3ï¼šè‡ªåŠ¨å¼¹å‡ºé”®ç›˜
view.becomeFirstResponder()
// æ•ˆæœï¼šè§†å›¾å‡ºç°æ—¶ç«‹å³å¼¹å‡ºé”®ç›˜
```

#### é—®é¢˜ï¼šå¦‚ä½•æ§åˆ¶"ä»…é¦–æ¬¡è‡ªåŠ¨å¼¹å‡ºé”®ç›˜"ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ `updateUIView` ä¸­æ·»åŠ æ¡ä»¶åˆ¤æ–­

```swift
func updateUIView(_ uiView: UITextView, context: Context) {
    if beginEdittingOnAppear,                          // 1. å…è®¸è‡ªåŠ¨ç¼–è¾‘
       !context.coordinator.disBecomeFirstResponder,   // 2. å°šæœªæ‰§è¡Œè¿‡
       uiView.window != nil,                           // 3. è§†å›¾å·²æ·»åŠ åˆ°çª—å£
       !uiView.isFirstResponder {                      // 4. å½“å‰ä¸æ˜¯ç¬¬ä¸€å“åº”è€…
        
        uiView.becomeFirstResponder()
        context.coordinator.disBecomeFirstResponder = true  // æ ‡è®°å·²æ‰§è¡Œ
    }
}
```

**ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›æ¡ä»¶ï¼Ÿ**
- `uiView.window != nil`ï¼šç¡®ä¿è§†å›¾å·²å®Œå…¨åŠ è½½
- `disBecomeFirstResponder`ï¼šé˜²æ­¢é‡å¤è§¦å‘
- `!uiView.isFirstResponder`ï¼šé¿å…é‡å¤æˆä¸ºç¬¬ä¸€å“åº”è€…

---

### ğŸ”‘ æŠ€æœ¯ç‚¹ 4ï¼š@Environment ä¸ @EnvironmentObject

#### @Environment(\.presentationMode)

**ç”¨é€”**ï¼šæ§åˆ¶å½“å‰è§†å›¾çš„æ˜¾ç¤º/å…³é—­

```swift
@Environment(\.presentationMode) var presentationMode

// å…³é—­å½“å‰è§†å›¾
presentationMode.wrappedValue.dismiss()
```

#### @EnvironmentObject

**ç”¨é€”**ï¼šè·¨è§†å›¾å…±äº«æ•°æ®ï¼Œæ— éœ€é€å±‚ä¼ é€’

```swift
// åœ¨çˆ¶è§†å›¾æ³¨å…¥
ContentView()
    .environmentObject(userData)

// åœ¨å­è§†å›¾ä½¿ç”¨
@EnvironmentObject var userData: UserData

// æ›´æ–°æ•°æ®ï¼ˆæ‰€æœ‰è®¢é˜…çš„è§†å›¾éƒ½ä¼šåˆ·æ–°ï¼‰
userData.update(post)
```

---

### ğŸ”‘ æŠ€æœ¯ç‚¹ 5ï¼šæ–‡æœ¬éªŒè¯ä¸ç”¨æˆ·åé¦ˆ

#### ç©ºå†…å®¹éªŒè¯

```swift
// å»é™¤ç©ºæ ¼å’Œæ¢è¡Œç¬¦ååˆ¤æ–­æ˜¯å¦ä¸ºç©º
if self.text.trimmingCharacters(in: .whitespacesAndNewlines).isEmpty {
    // æ˜¾ç¤ºæç¤º
    self.showEmptyTextHUD = true
    
    // 1 ç§’åè‡ªåŠ¨éšè—
    DispatchQueue.main.asyncAfter(deadline: .now() + 1) {
        self.showEmptyTextHUD = false
    }
    return
}
```

#### åŠ¨ç”»æç¤ºæ•ˆæœ

```swift
.overlay {
    Text("è¯„è®ºä¸èƒ½ä¸ºç©º")
        .scaleEffect(showEmptyTextHUD ? 1 : 0.5)      // ç¼©æ”¾åŠ¨ç”»
        .animation(.easeInOut)
        .opacity(showEmptyTextHUD ? 1 : 0)            // é€æ˜åº¦åŠ¨ç”»
        .animation(.spring(dampingFraction: 0.5))     // å¼¹ç°§åŠ¨ç”»
}
```

**åŠ¨ç”»æ•ˆæœåˆ†æ**ï¼š
- `scaleEffect`ï¼šä» 0.5 å€æ”¾å¤§åˆ° 1 å€ï¼ˆå¼¹å‡ºæ•ˆæœï¼‰
- `opacity`ï¼šä»é€æ˜åˆ°ä¸é€æ˜
- `spring`ï¼šå¼¹ç°§é˜»å°¼åŠ¨ç”»ï¼Œæ›´è‡ªç„¶

---

## ä»£ç å®ç°è¯¦è§£

### å®Œæ•´å®ç°æµç¨‹

#### æ­¥éª¤ 1ï¼šåˆ›å»º UITextView å°è£…

```swift
struct CommentTextView: UIViewRepresentable {
    @Binding var text: String
    let beginEdittingOnAppear: Bool
    
    // 1ï¸âƒ£ åˆ›å»ºåè°ƒå™¨
    func makeCoordinator() -> Coordinator {
        Coordinator(self)
    }
    
    // 2ï¸âƒ£ åˆ›å»ºå¹¶é…ç½® UITextView
    func makeUIView(context: Context) -> UITextView {
        let view = UITextView()
        
        // å¤–è§‚é…ç½®
        view.backgroundColor = .systemGray6
        view.font = .systemFont(ofSize: 18)
        view.textContainerInset = UIEdgeInsets(top: 15, left: 15, bottom: 15, right: 15)
        
        // å§”æ‰˜è®¾ç½®
        view.delegate = context.coordinator
        view.text = text
        
        // é”®ç›˜è¡Œä¸ºé…ç½®ï¼ˆæ ¸å¿ƒï¼‰
        view.keyboardDismissMode = .interactive  // äº¤äº’å¼æ”¶èµ·
        view.alwaysBounceVertical = true         // å§‹ç»ˆå¯å¼¹è·³
        view.isScrollEnabled = true              // å¯ç”¨æ»šåŠ¨
        view.becomeFirstResponder()              // è‡ªåŠ¨å¼¹å‡ºé”®ç›˜
        
        return view
    }
    
    // 3ï¸âƒ£ æ›´æ–°è§†å›¾çŠ¶æ€
    func updateUIView(_ uiView: UITextView, context: Context) {
        if beginEdittingOnAppear,
           !context.coordinator.disBecomeFirstResponder,
           uiView.window != nil,
           !uiView.isFirstResponder {
            uiView.becomeFirstResponder()
            context.coordinator.disBecomeFirstResponder = true
        }
    }
    
    // 4ï¸âƒ£ åè°ƒå™¨å®ç°
    class Coordinator: NSObject, UITextViewDelegate {
        let parent: CommentTextView
        var disBecomeFirstResponder: Bool = false
        
        init(_ view: CommentTextView) { 
            parent = view 
        }
        
        func textViewDidChange(_ textView: UITextView) {
            parent.text = textView.text
        }
    }
}
```

---

#### æ­¥éª¤ 2ï¼šåˆ›å»ºè¯„è®ºè¾“å…¥ç•Œé¢

```swift
struct CommentInputView: View {
    let post: Post
    
    @Environment(\.presentationMode) var presentationMode
    @EnvironmentObject var userData: UserData
    
    @State private var text: String = ""
    @State private var showEmptyTextHUD: Bool = false
    
    var body: some View {
        VStack(spacing: 0) {
            // 1ï¸âƒ£ æ–‡æœ¬è¾“å…¥åŒºåŸŸ
            CommentTextView(text: $text, beginEdittingOnAppear: true)
                .frame(maxWidth: .infinity, maxHeight: .infinity)
            
            // 2ï¸âƒ£ åº•éƒ¨æ“ä½œæ 
            HStack(spacing: 0) {
                // å–æ¶ˆæŒ‰é’®
                Button {
                    self.presentationMode.wrappedValue.dismiss()
                } label: {
                    Text("å–æ¶ˆ").padding()
                }
                
                Spacer()
                
                // å‘é€æŒ‰é’®
                Button {
                    // éªŒè¯è¾“å…¥
                    if self.text.trimmingCharacters(in: .whitespacesAndNewlines).isEmpty {
                        self.showEmptyTextHUD = true
                        DispatchQueue.main.asyncAfter(deadline: .now() + 1) {
                            self.showEmptyTextHUD = false
                        }
                        return
                    }
                    
                    // å¤„ç†è¯„è®º
                    print(self.text)
                    var post = self.post
                    post.commentCount += 1
                    self.userData.update(post)
                    
                    // å…³é—­è§†å›¾
                    self.presentationMode.wrappedValue.dismiss()
                } label: {
                    Text("å‘é€").padding()
                }
            }
            .font(.system(size: 18))
            .foregroundColor(.black)
        }
        // 3ï¸âƒ£ æç¤ºä¿¡æ¯è¦†ç›–å±‚
        .overlay {
            Text("è¯„è®ºä¸èƒ½ä¸ºç©º")
                .scaleEffect(showEmptyTextHUD ? 1 : 0.5)
                .animation(.easeInOut)
                .opacity(showEmptyTextHUD ? 1 : 0)
                .animation(.spring(dampingFraction: 0.5))
        }
    }
}
```

---

## æœ€ä½³å®è·µ

### âœ… DO - æ¨èåšæ³•

1. **ä½¿ç”¨ UIViewRepresentable å°è£…å¤æ‚ UIKit ç»„ä»¶**
   ```swift
   // å°†å¤æ‚çš„ UIKit è§†å›¾å°è£…æˆç‹¬ç«‹ç»„ä»¶
   struct CustomTextView: UIViewRepresentable { ... }
   ```

2. **é€šè¿‡ Coordinator å¤„ç†å§”æ‰˜**
   ```swift
   // ä¸è¦åœ¨ makeUIView ä¸­ç›´æ¥å¤„ç†å§”æ‰˜
   class Coordinator: NSObject, UITextViewDelegate { ... }
   ```

3. **ä½¿ç”¨ @Binding å®ç°åŒå‘æ•°æ®ç»‘å®š**
   ```swift
   @Binding var text: String  // çˆ¶å­ç»„ä»¶æ•°æ®åŒæ­¥
   ```

4. **æ·»åŠ è¾“å…¥éªŒè¯**
   ```swift
   text.trimmingCharacters(in: .whitespacesAndNewlines).isEmpty
   ```

5. **æä¾›ç”¨æˆ·åé¦ˆ**
   ```swift
   // ä½¿ç”¨åŠ¨ç”»æç¤ºç”¨æˆ·æ“ä½œç»“æœ
   .animation(.spring(dampingFraction: 0.5))
   ```

---

### âŒ DON'T - é¿å…åšæ³•

1. **ä¸è¦åœ¨ makeUIView ä¸­æ‰§è¡Œå¼‚æ­¥æ“ä½œ**
   ```swift
   // âŒ é”™è¯¯
   func makeUIView(context: Context) -> UITextView {
       DispatchQueue.main.async { ... }  // å¯èƒ½å¯¼è‡´å´©æºƒ
   }
   ```

2. **ä¸è¦å¿˜è®°è®¾ç½® delegate**
   ```swift
   // âŒ é”™è¯¯
   func makeUIView(context: Context) -> UITextView {
       let view = UITextView()
       // view.delegate = context.coordinator  // å¿˜è®°è®¾ç½®
       return view
   }
   ```

3. **ä¸è¦åœ¨ updateUIView ä¸­æ— æ¡ä»¶æ‰§è¡Œæ“ä½œ**
   ```swift
   // âŒ é”™è¯¯ï¼šä¼šå¯¼è‡´æ— é™å¾ªç¯
   func updateUIView(_ uiView: UITextView, context: Context) {
       uiView.becomeFirstResponder()  // æ¯æ¬¡æ›´æ–°éƒ½æ‰§è¡Œ
   }
   
   // âœ… æ­£ç¡®ï¼šæ·»åŠ æ¡ä»¶åˆ¤æ–­
   func updateUIView(_ uiView: UITextView, context: Context) {
       if !context.coordinator.didBecomeFirstResponder {
           uiView.becomeFirstResponder()
           context.coordinator.didBecomeFirstResponder = true
       }
   }
   ```

4. **ä¸è¦ç›´æ¥ä¿®æ”¹ @Binding çš„å€¼è€Œä¸é€šçŸ¥ SwiftUI**
   ```swift
   // âŒ é”™è¯¯
   textView.text = "new value"  // UIKit å±‚é¢ä¿®æ”¹
   
   // âœ… æ­£ç¡®
   parent.text = textView.text  // é€šè¿‡ @Binding æ›´æ–°
   ```

---

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### Q1: é”®ç›˜æ— æ³•é€šè¿‡æ»‘åŠ¨æ”¶èµ·ï¼Ÿ

**åŸå› **ï¼šæœªæ­£ç¡®é…ç½® `keyboardDismissMode` å’Œ `alwaysBounceVertical`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```swift
view.keyboardDismissMode = .interactive
view.alwaysBounceVertical = true
view.isScrollEnabled = true
```

---

### Q2: é”®ç›˜å¼¹å‡ºæ—¶æœºä¸å¯¹ï¼Ÿ

**åŸå› **ï¼š`becomeFirstResponder()` è°ƒç”¨æ—¶æœºè¿‡æ—©

**è§£å†³æ–¹æ¡ˆ**ï¼š
```swift
func updateUIView(_ uiView: UITextView, context: Context) {
    // ç¡®ä¿è§†å›¾å·²æ·»åŠ åˆ°çª—å£
    if uiView.window != nil, !uiView.isFirstResponder {
        uiView.becomeFirstResponder()
    }
}
```

---

### Q3: æ–‡æœ¬æ›´æ–°ä¸åŒæ­¥ï¼Ÿ

**åŸå› **ï¼šæœªæ­£ç¡®å®ç° `UITextViewDelegate`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```swift
func textViewDidChange(_ textView: UITextView) {
    parent.text = textView.text  // å®æ—¶åŒæ­¥åˆ° @Binding
}
```

---

### Q4: åŠ¨ç”»æ•ˆæœä¸æµç•…ï¼Ÿ

**åŸå› **ï¼šåŠ¨ç”»é…ç½®ä¸å½“

**è§£å†³æ–¹æ¡ˆ**ï¼š
```swift
// ä½¿ç”¨å¼¹ç°§åŠ¨ç”»
.animation(.spring(dampingFraction: 0.5))

// æˆ–ä½¿ç”¨ç¼“åŠ¨åŠ¨ç”»
.animation(.easeInOut(duration: 0.3))
```

---

### Q5: å¦‚ä½•åœ¨è¯„è®ºå‘é€åæ¸…ç©ºè¾“å…¥æ¡†ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```swift
Button {
    // å‘é€è¯„è®º...
    self.text = ""  // æ¸…ç©ºè¾“å…¥
    self.presentationMode.wrappedValue.dismiss()
} label: {
    Text("å‘é€")
}
```

---

### Q6: å¦‚ä½•é™åˆ¶è¾“å…¥å­—æ•°ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```swift
class Coordinator: NSObject, UITextViewDelegate {
    func textView(_ textView: UITextView, shouldChangeTextIn range: NSRange, replacementText text: String) -> Bool {
        let currentText = textView.text ?? ""
        let newLength = currentText.count + text.count - range.length
        return newLength <= 500  // é™åˆ¶ 500 å­—
    }
}
```

---

## è¿›é˜¶æ‰©å±•

### æ‰©å±• 1ï¼šæ·»åŠ å­—æ•°ç»Ÿè®¡

```swift
struct CommentInputView: View {
    @State private var text: String = ""
    
    var body: some View {
        VStack {
            CommentTextView(text: $text, beginEdittingOnAppear: true)
            
            HStack {
                Text("\(text.count)/500")
                    .foregroundColor(text.count > 500 ? .red : .gray)
                Spacer()
            }
            .padding()
        }
    }
}
```

---

### æ‰©å±• 2ï¼šæ·»åŠ è¡¨æƒ…é€‰æ‹©å™¨

```swift
struct CommentInputView: View {
    @State private var showEmojiPicker = false
    
    var body: some View {
        VStack {
            CommentTextView(text: $text, beginEdittingOnAppear: true)
            
            HStack {
                Button {
                    showEmojiPicker.toggle()
                } label: {
                    Image(systemName: "face.smiling")
                }
                // ...
            }
        }
        .sheet(isPresented: $showEmojiPicker) {
            EmojiPickerView(text: $text)
        }
    }
}
```

---

### æ‰©å±• 3ï¼šæ·»åŠ  @ æåŠåŠŸèƒ½

```swift
class Coordinator: NSObject, UITextViewDelegate {
    func textViewDidChange(_ textView: UITextView) {
        parent.text = textView.text
        
        // æ£€æµ‹ @ ç¬¦å·
        if let lastChar = textView.text.last, lastChar == "@" {
            parent.showMentionList = true
        }
    }
}
```

---

## æ€»ç»“

æœ¬æ•™ç¨‹æ¶µç›–äº†ä»¥ä¸‹æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š

1. âœ… **UIViewRepresentable** - æ¡¥æ¥ UIKit å’Œ SwiftUI
2. âœ… **Coordinator æ¨¡å¼** - å¤„ç†å§”æ‰˜å›è°ƒ
3. âœ… **é”®ç›˜äº¤äº’ä¼˜åŒ–** - æå‡ç”¨æˆ·ä½“éªŒ
4. âœ… **æ•°æ®ç»‘å®š** - @Bindingã€@Environmentã€@EnvironmentObject
5. âœ… **è¾“å…¥éªŒè¯** - æ–‡æœ¬å¤„ç†ä¸ç”¨æˆ·åé¦ˆ
6. âœ… **åŠ¨ç”»æ•ˆæœ** - æå‡ç•Œé¢æµç•…åº¦

é€šè¿‡å­¦ä¹ è¿™ä¸ªè¯„è®ºåŠŸèƒ½çš„å®ç°ï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š
- ç†è§£å¦‚ä½•åœ¨ SwiftUI ä¸­ä½¿ç”¨ UIKit ç»„ä»¶
- æŒæ¡ UIViewRepresentable çš„ä½¿ç”¨æ–¹æ³•
- å®ç°æµç•…çš„é”®ç›˜äº¤äº’ä½“éªŒ
- æ„å»ºå®Œæ•´çš„ç”¨æˆ·è¾“å…¥æµç¨‹

---

## å‚è€ƒèµ„æº

- [Apple å®˜æ–¹æ–‡æ¡£ - UIViewRepresentable](https://developer.apple.com/documentation/swiftui/uiviewrepresentable)
- [Apple å®˜æ–¹æ–‡æ¡£ - UITextView](https://developer.apple.com/documentation/uikit/uitextview)
- [SwiftUI æ•°æ®æµ](https://developer.apple.com/documentation/swiftui/managing-model-data-in-your-app)

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2026å¹´1æœˆ29æ—¥  
**ä½œè€…**ï¼šåŸºäº WeiboDemo é¡¹ç›®æ•´ç†

